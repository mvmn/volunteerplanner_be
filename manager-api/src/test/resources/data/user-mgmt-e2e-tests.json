[
  {
    "name": "create root",
    "given": {
      "request": {
        "endpoint": "/users",
        "method": "POST",
        "body": {
          "userName": "root",
          "phoneNumber": "111",
          "password": "root",
          "role": "root",
          "fullName": "FN root",
          "city": {
            "id": 20
          }
        }
      }
    },
    "expected": {
      "status": 201,
      "body": {
        "id": 1,
        "userName": "root",
        "phoneNumber": "111",
        "password": "******",
        "role": "root",
        "fullName": "FN root",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": true,
        "userVerified": true,
        "userVerifiedByUserId": 1,
        "userVerifiedAt": "any value",
        "locked": false
      }
    }
  },
  {
    "name": "create operator",
    "given": {
      "request": {
        "endpoint": "/users",
        "method": "POST",
        "body": {
          "userName": "operator",
          "phoneNumber": "222",
          "password": "operator",
          "role": "operator",
          "fullName": "FN operator",
          "city": {
            "id": 20
          }
        }
      }
    },
    "expected": {
      "status": 201,
      "body": {
        "id": 2,
        "userName": "operator",
        "phoneNumber": "222",
        "password": "******",
        "role": "operator",
        "fullName": "FN operator",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": false,
        "userVerified": false,
        "locked": false
      }
    }
  },
  {
    "name": "operator: verify himself",
    "given": {
      "auth": {
        "userName": "operator",
        "password": "operator"
      },
      "request": {
        "endpoint": "/users/2/verify/user",
        "method": "PUT"
      }
    },
    "expected": {
      "status": 403
    }
  },
  {
    "name": "verify user: operator",
    "given": {
      "auth": {
        "userName": "root",
        "password": "root"
      },
      "request": {
        "endpoint": "/users/2/verify/user",
        "method": "PUT"
      }
    },
    "expected": {
      "status": 200,
      "body": {
        "id": 2,
        "userName": "operator",
        "phoneNumber": "222",
        "password": "******",
        "role": "operator",
        "fullName": "FN operator",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": false,
        "userVerified": true,
        "userVerifiedByUserId": 1,
        "userVerifiedAt": "any value",
        "locked": false
      }
    }
  },
  {
    "name": "verify phone: operator",
    "given": {
      "auth": {
        "userName": "root",
        "password": "root"
      },
      "request": {
        "endpoint": "/users/2/verify/phone",
        "method": "PUT"
      }
    },
    "expected": {
      "status": 200,
      "body": {
        "id": 2,
        "userName": "operator",
        "phoneNumber": "222",
        "password": "******",
        "role": "operator",
        "fullName": "FN operator",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": true,
        "userVerified": true,
        "userVerifiedByUserId": 1,
        "userVerifiedAt": "any value",
        "locked": false
      }
    }
  },
  {
    "name": "create volunteer",
    "given": {
      "request": {
        "endpoint": "/users",
        "method": "POST",
        "body": {
          "userName": "volunteer",
          "phoneNumber": "333",
          "password": "volunteer",
          "role": "volunteer",
          "fullName": "FN volunteer",
          "city": {
            "id": 20
          }
        }
      }
    },
    "expected": {
      "status": 201,
      "body": {
        "id": 3,
        "userName": "volunteer",
        "phoneNumber": "333",
        "password": "******",
        "role": "volunteer",
        "fullName": "FN volunteer",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": false,
        "userVerified": false,
        "locked": false
      }
    }
  },
  {
    "name": "verify user: volunteer",
    "given": {
      "auth": {
        "userName": "operator",
        "password": "operator"
      },
      "request": {
        "endpoint": "/users/3/verify/user",
        "method": "PUT"
      }
    },
    "expected": {
      "status": 200,
      "body": {
        "id": 3,
        "userName": "volunteer",
        "phoneNumber": "333",
        "password": "******",
        "role": "volunteer",
        "fullName": "FN volunteer",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": false,
        "userVerified": true,
        "userVerifiedByUserId": 2,
        "userVerifiedAt": "any value",
        "locked": false
      }
    }
  },
  {
    "name": "verify phone: volunteer",
    "given": {
      "auth": {
        "userName": "root",
        "password": "root"
      },
      "request": {
        "endpoint": "/users/3/verify/phone",
        "method": "PUT"
      }
    },
    "expected": {
      "status": 200,
      "body": {
        "id": 3,
        "userName": "volunteer",
        "phoneNumber": "333",
        "password": "******",
        "role": "volunteer",
        "fullName": "FN volunteer",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": true,
        "userVerified": true,
        "userVerifiedByUserId": 2,
        "userVerifiedAt": "any value",
        "locked": false
      }
    }
  },
  {
    "name": "get myself",
    "given": {
      "auth": {
        "userName": "volunteer",
        "password": "volunteer"
      },
      "request": {
        "endpoint": "/users/current",
        "method": "GET"
      }
    },
    "expected": {
      "status": 200,
      "body": {
        "id": 3,
        "userName": "volunteer",
        "phoneNumber": "333",
        "password": "******",
        "role": "volunteer",
        "fullName": "FN volunteer",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": true,
        "userVerified": true,
        "userVerifiedByUserId": 2,
        "userVerifiedAt": "any value",
        "locked": false
      }
    }
  },
  {
    "name": "password change for valid password",
    "given": {
      "auth": {
        "userName": "volunteer",
        "password": "volunteer"
      },
      "request": {
        "endpoint": "/users/current/password/change",
        "method": "PUT",
        "body": {
          "old": "volunteer",
          "new": "volunteer1"
        }
      }
    },
    "expected": {
      "status": 204
    }
  },
  {
    "name": "password change for invalid password",
    "given": {
      "auth": {
        "userName": "volunteer",
        "password": "volunteer1"
      },
      "request": {
        "endpoint": "/users/current/password/change",
        "method": "PUT",
        "body": {
          "old": "volunteer",
          "new": "volunteer1"
        }
      }
    },
    "expected": {
      "status": 400,
      "body": {
        "errorMessage": "Old password does not match current one"
      }
    }
  },
  {
    "name": "duplicate username",
    "given": {
      "request": {
        "endpoint": "/users",
        "method": "POST",
        "body": {
          "userName": "root",
          "phoneNumber": "222",
          "password": "root",
          "role": "volunteer",
          "fullName": "FN duplicate",
          "city": {
            "id": 20
          }
        }
      }
    },
    "expected": {
      "status": 409,
      "body": {
        "errorMessage": "user.userName is not unique"
      }
    }
  },
  {
    "name": "duplicate phone number",
    "given": {
      "request": {
        "endpoint": "/users",
        "method": "POST",
        "body": {
          "userName": "vivo",
          "phoneNumber": "222",
          "password": "vivo",
          "role": "volunteer",
          "fullName": "FN duplicate",
          "city": {
            "id": 20
          }
        }
      }
    },
    "expected": {
      "status": 409,
      "body": {
        "errorMessage": "user.phoneNumber is not unique"
      }
    }
  },
  {
    "name": "operator: get by id",
    "given": {
      "auth": {
        "userName": "operator",
        "password": "operator"
      },
      "request": {
        "endpoint": "/users/1",
        "method": "GET"
      }
    },
    "expected": {
      "status": 200,
      "body": {
        "id": 1,
        "userName": "root",
        "phoneNumber": "111",
        "password": "******",
        "role": "root",
        "fullName": "FN root",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": true,
        "userVerified": true,
        "userVerifiedByUserId": 1,
        "userVerifiedAt": "any string",
        "locked": false
      }
    }
  },
  {
    "name": "volunteer: get by id",
    "given": {
      "auth": {
        "userName": "volunteer",
        "password": "volunteer1"
      },
      "request": {
        "endpoint": "/users/1",
        "method": "GET"
      }
    },
    "expected": {
      "status": 403
    }
  },
  {
    "name": "root: lock",
    "given": {
      "auth": {
        "userName": "root",
        "password": "root"
      },
      "request": {
        "endpoint": "/users/2/lock",
        "method": "PUT"
      }
    },
    "expected": {
      "status": 200,
      "body": {
        "id": 2,
        "userName": "operator",
        "phoneNumber": "222",
        "password": "******",
        "role": "operator",
        "fullName": "FN operator",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": true,
        "userVerified": true,
        "userVerifiedByUserId": 1,
        "userVerifiedAt": "any-date",
        "locked": true,
        "lockedByUserId": 1,
        "lockedAt": "any-date"
      }
    }
  },
  {
    "name": "root: unlock",
    "given": {
      "auth": {
        "userName": "root",
        "password": "root"
      },
      "request": {
        "endpoint": "/users/2/unlock",
        "method": "PUT"
      }
    },
    "expected": {
      "status": 200,
      "body": {
        "id": 2,
        "userName": "operator",
        "phoneNumber": "222",
        "password": "******",
        "role": "operator",
        "fullName": "FN operator",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": true,
        "userVerified": true,
        "userVerifiedByUserId": 1,
        "userVerifiedAt": "any-date",
        "locked": false
      }
    }
  },
  {
    "name": "search",
    "given": {
      "auth": {
        "userName": "operator",
        "password": "operator"
      },
      "request": {
        "endpoint": "/users/search",
        "method": "POST",
        "body": {
          "page": 1,
          "pageSize": 10,
          "filter": {
            "type": "text",
            "field": "role.name",
            "value": "volunteer"
          }
        }
      }
    },
    "expected": {
      "status": 200,
      "body": {
        "page": 1,
        "pageSize": 10,
        "totalCount": 1,
        "items": [
          {
            "id": 3,
            "userName": "volunteer",
            "phoneNumber": "333",
            "password": "******",
            "role": "volunteer",
            "fullName": "FN volunteer",
            "city": {
              "id": 20,
              "region": {
                "id": 1,
                "name": "Вінницька"
              },
              "name": "Уланов"
            },
            "phoneNumberVerified": true,
            "userVerified": true,
            "userVerifiedByUserId": 2,
            "userVerifiedAt": "any value",
            "locked": false
          }
        ]
      }
    }
  },
  {
    "name": "create volunteer 2",
    "given": {
      "request": {
        "endpoint": "/users",
        "method": "POST",
        "body": {
          "userName": "volunteer2",
          "phoneNumber": "123",
          "password": "volunteer2",
          "role": "volunteer",
          "fullName": "FN volunteer",
          "city": {
            "id": 20
          }
        }
      }
    },
    "expected": {
      "status": 201,
      "body": {
        "id": 6,
        "userName": "volunteer2",
        "phoneNumber": "123",
        "password": "******",
        "role": "volunteer",
        "fullName": "FN volunteer",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": false,
        "userVerified": false,
        "locked": false
      }
    }
  },
  {
    "name": "sms start verification",
    "given": {
      "auth": {
        "userName": "volunteer2",
        "password": "volunteer2"
      },
      "request": {
        "endpoint": "/users/current/sms",
        "method": "GET"
      }
    },
    "expected": {
      "status": 204
    }
  },
  {
    "name": "sms fail verification",
    "given": {
      "auth": {
        "userName": "volunteer2",
        "password": "volunteer2"
      },
      "request": {
        "endpoint": "/users/current/sms",
        "method": "POST",
        "body": {
          "code": "000000"
        }
      }
    },
    "expected": {
      "status": 400,
      "body": {
        "errorMessage": "Verification code doesn't match"
      }
    }
  },
  {
    "name": "sms success verification",
    "given": {
      "auth": {
        "userName": "volunteer2",
        "password": "volunteer2"
      },
      "request": {
        "endpoint": "/users/current/sms",
        "method": "POST",
        "body": {
          "code": "123456"
        }
      }
    },
    "expected": {
      "status": 200,
      "body": {
        "id": 6,
        "userName": "volunteer2",
        "phoneNumber": "123",
        "password": "******",
        "role": "volunteer",
        "fullName": "FN volunteer",
        "city": {
          "id": 20,
          "region": {
            "id": 1,
            "name": "Вінницька"
          },
          "name": "Уланов"
        },
        "phoneNumberVerified": true,
        "userVerified": false,
        "locked": false
      }
    }
  }
]